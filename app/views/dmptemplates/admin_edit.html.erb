<%= stylesheet_link_tag "admin" %>
<% javascript 'admin.js' %>

<h1>
	<%= @dmptemplate.title %>
	<!-- link button to add new guidance -->
	<div class="move_2_right">
		<%= link_to t("org_admin.templates.view_all_templates"),
		            admin_index_dmptemplate_path,
		            :class => 'btn btn-primary' %>
	</div>            
</h1>

<div class="div_clear"></div>

<!-- render navigation tabs for the template-->
<%= render :partial => "templates_nav_tabs", locals: {dmptemplate: @dmptemplate, active: "show_template"} %>

<!-- body -->
<div class="dmp_details_body">
	<div class="dmp_details">
		<%= form_for(@dmptemplate, :url => admin_update_dmptemplate_path(@dmptemplate), :html => { :method => :put}) do |f| %>
		
			<table class="dmp_details_table">
				<tr>
					<td class="first"><%= t('org_admin.templates.title_label') %></td>
					<td><%= f.text_field :title, 
								:as => :string, 
								:class => 'text_field has-tooltip', 'data-toggle' => "tooltip", 'title' => t('org_admin.templates.title_help_text') %></td>
				</tr>
				<tr>
					<td class="first"><%= t('org_admin.templates.desc_label') %></td>
					<td><%= text_area_tag("template-desc", @dmptemplate.description, class: "tinymce") %>
					</td>
				</tr>
				<tr>
					<td class="first"><%= t('org_admin.templates.published_label') %></td>
					<td><%= f.check_box :published, 
							:as => :check_boxes
							%>
					</td>
				</tr>
				<tr>
					<td class="first"><%= t('org_admin.templates.created') %></td>
					<td>
						<%= l @dmptemplate.created_at.to_date, :formats => :short %>
					</td>
				</tr>
				<tr>
					<td class="first"><%= t('org_admin.templates.last_updated') %></td>
					<td>
						<%= l @dmptemplate.updated_at.to_date, :formats => :short %>
					</td>
				</tr>
			</table>
			<!-- submit buttons -->
			
				<div class="move_2_right">
					<%= f.submit t('helpers.submit.save'), :class => 'btn btn-primary' %>
					<%= link_to t('helpers.submit.cancel'), :back, :class => 'btn btn-primary' %>
				</div>
			
			<br />
			<%= tinymce :content_css => asset_path('application.css') %>
		<%end%>	
	</div>
	<!-- If template has phases-->
	<% if !@dmptemplate.phases.nil? then %>
		<% if @dmptemplate.phases.count == 1 then %>
			<% @dmptemplate.phases.each do |phase| %>
				
				<div class="div_clear"></div>
				
				<div class="div_left">
					<p><%= raw phase.description %></p>
				</div>	 
				<div class="div_right">
					<%= link_to t('org_admin.templates.view_phase_label'), admin_showphase_dmptemplate_path(phase), :class => "btn btn-primary" %>
					<%= link_to t('org_admin.templates.edit_phase_label'), admin_editphase_dmptemplate_path(phase), :class => "btn btn-primary" %>
				</div>
				
				<% if phase.versions.any? then %>
					<% phase.versions.each do |version|%>
						<% if version.sections.any? then %>
							<table class="dmp_table">
								<thead>
								    <tr>
								      	<th class="dmp_th_medium"><%= t('helpers.sections_label')%></th>
								      	<th class="dmp_th_big"><%= t('helpers.questions_label')%></th>
				   					</tr>
			   					</thead>
			   					<tbody>
			   						<% version.sections.each do |section| %>
										<tr >
											<th class="dmp_th_border" >
												<p><%= section.title %></p>
											</th>
			        						<td class="dmp_td_border" >	
												<% if section.questions.any? %>
													<% questions = section.questions.sort_by(&:number) %>
													<ul class="question_ul">
														<% questions.each do |ques|%>
															<li>
																- <%= ques.text %>
															</li>	
														<%end%>
													</ul>
												<%end%>		
											</td>
										</tr>		
									<%end%>
								</tbody>	
							</table>
						<%end%>
					<%end%>
				<%end%>	
			<%end%>
		<%else%>	
			<% @dmptemplate.phases.each do |phase| %>
				<div class="accordion" id="project-accordion">
					<div class="accordion-group">
						<div class="accordion-heading">
							<a class="accordion-toggle" data-toggle="collapse" data-parent="#project-accordion" href="#<%= phase.id %>">
								<h3><%= phase.title %><span class="plus-laranja"> </span>
								</h3>
							</a>
						</div>
						<div id="<%= phase.id %>" class="accordion-project collapse">
							<div class="accordion-inner">
								
								<div class="div_clear"></div>
				
								<div class="div_left">
									<p><%= raw phase.description %></p>
								</div>	 
								<div class="div_right">
									<%= link_to t('org_admin.templates.view_phase_label'), admin_showphase_dmptemplate_path(phase), :class => "btn btn-primary" %>
									<%= link_to t('org_admin.templates.edit_phase_label'), admin_editphase_dmptemplate_path(phase), :class => "btn btn-primary" %>
								</div>
												
								<% if !phase.versions.nil? %>
									<% phase.versions.each do |version|%>
										<table class="dmp_table">
											<thead>
											    <tr>
											      	<th class="dmp_th_medium"><%= t('helpers.sections_label')%></th>
											      	<th class="dmp_th_big"><%= t('helpers.questions_label')%></th>
							   					</tr>
						   					</thead>
						   					<tbody>
						   						<% version.sections.each do |section| %>
													<tr >
														<th class="dmp_th_border" >
															<p><%= section.title %></p>
														</th>
						        						<td class="dmp_td_border" >	
															<% if section.questions.any? %>
																<% questions = section.questions.sort_by(&:number) %>
																<ul class="question_ul">
																	<% questions.each do |ques|%>
																		<li>
																			- <%= ques.text %>
																		</li>	
																	<%end%>
																</ul>
															<%end%>		
														</td>
													</tr>		
												<%end%>
											</tbody>	
										</table>
									<%end%>	
								<%end%>
							</div>
						</div>
					</div>
				</div>				
			<%end%>	
		<%end%>	
	<%end%>				
</div>						
							